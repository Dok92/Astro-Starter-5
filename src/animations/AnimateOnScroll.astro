---
const { animation, duration = 0.8, delay = 0, treshold, rootMargin } = Astro.props;
---

<div
  class='observer-container'
  data-treshold={treshold}
  data-rootmargin={rootMargin}
  data-animation={animation}
  style={`--duration: ${duration}s; --delay: ${delay}s;`}>
  <slot />
</div>

<style>
  .observer-container {
    --duration: 0.8s;
    --delay: 0s;
  }

  .observer-container > :global(*) {
    opacity: 0;
    visibility: hidden;
  }

  .observer-container.is-visible > :global(*) {
    visibility: visible;
    animation-duration: var(--duration);
    animation-delay: var(--delay);
    animation-fill-mode: forwards;
    animation-timing-function: cubic-bezier(0.26, 0.51, 0.58, 1);
  }

  .observer-container[data-animation='up-slide'].is-visible > :global(*) {
    animation-name: up-slide;
  }

  .observer-container[data-animation='down-slide'].is-visible > :global(*) {
    animation-name: down-slide;
  }

  .observer-container[data-animation='slide-from-left'].is-visible > :global(*) {
    animation-name: slide-from-left;
  }

  .observer-container[data-animation='slide-from-right'].is-visible > :global(*) {
    animation-name: slide-from-right;
  }

  .observer-container[data-animation='slide-from-down-left'].is-visible > :global(*) {
    animation-name: slide-from-down-left;
  }

  .observer-container[data-animation='slide-from-down-right'].is-visible > :global(*) {
    animation-name: slide-from-down-right;
  }
  .observer-container[data-animation='fade'].is-visible > :global(*) {
    animation-name: fade;
  }

  @keyframes up-slide {
    from {
      opacity: 0;
      transform: translateY(80px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes down-slide {
    from {
      opacity: 0;
      transform: translateY(-130px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slide-from-left {
    from {
      opacity: 0;
      transform: translateX(-80px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slide-from-right {
    from {
      opacity: 0;
      transform: translateX(80px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slide-from-down-left {
    from {
      opacity: 0;
      transform: translate(-80px, 80px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }

  @keyframes slide-from-down-right {
    from {
      opacity: 0;
      transform: translate(80px, 80px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }

  @keyframes fade {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const observerContainers = document.querySelectorAll('.observer-container');

    observerContainers.forEach((container) => {
      const rootMarginValue = (container as HTMLElement).dataset.rootmargin || '0px 0px -100px 0px';
      const tresholdValue = parseFloat((container as HTMLElement).dataset.treshold || '0.2');

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        {
          rootMargin: rootMarginValue,
          threshold: tresholdValue,
        },
      );

      observer.observe(container);
    });
  });
</script>
